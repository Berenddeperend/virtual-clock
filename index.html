<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>virtual-clock</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="A small library for configurable, high-resolution, high-performance virtual clocks"/>
    <meta name="author" content="DvdGiessen"/>
    <meta name="keywords" content="virtual-clock clock timer stopwatch settimout setinterval virtual time timing timeout interval duration event hrtime hpet javascript npm nodejs browser es6 flow typescript"/>
    <style type="text/css">
    </style>
</head>
<body>
    <h1>virtual-clock</h1>
    <p>
        <em>A small library for configurable, high-resolution, high-performance virtual clocks</em>
    </p>
    <p>
        <a href="https://www.npmjs.com/package/virtual-clock"><img src="https://img.shields.io/npm/v/virtual-clock.svg" alt="npm"></a>
        <a href="https://github.com/DvdGiessen/virtual-clock/blob/master/LICENSE"><img src="https://img.shields.io/npm/l/virtual-clock.svg" alt="license"></a>
        <a href="https://david-dm.org/DvdGiessen/virtual-clock"><img src="https://img.shields.io/david/DvdGiessen/virtual-clock.svg" alt="dependencies" ></a>
        <a href="https://codecov.io/gh/DvdGiessen/virtual-clock"><img src="https://img.shields.io/codecov/c/github/DvdGiessen/virtual-clock/master.svg" alt="coverage"></a>
        <a href="https://www.codacy.com/app/github_94/virtual-clock"><img src="https://img.shields.io/codacy/grade/bae573f4dab14b01af199ad21c810318/master.svg" alt="code quality"></a>
        <a href="https://travis-ci.org/DvdGiessen/virtual-clock"><img src="https://img.shields.io/travis/DvdGiessen/virtual-clock/master.svg" alt="build status"></a>
    </p>
    <h2>Overview</h2>
    <p>
        This small and efficient library provides configurable virtual clocks for
        tracking time in for example simulations, games, media applications, or even
        just a simple stopwatch.
    </p>
    <p>
        Virtual clocks can be started and stopped, the rate at which time flows can be
        altered and even be made negative, causing time to flow backwards. Time can be
        limited by a minimum and maximum value, and when both a minimum and maximum are
        defined time may be set to loop around. Time listeners may be attached which
        will fire when a given (absolute) time on the clock is passed, without having
        to worry about adjusting timeouts for pauses, rate changes or other conditions.
    </p>
    <p>
        <code>virtual-clock</code> uses high resolution time data for its virtualized clocks,
        independent of system clock drift (for example when being skewed by software
        like NTP). No timers are used for calculating the virtual clock time, instead
        some clever math is used to calculate time whenever it is requested.
    </p>
    <p>
        The library has extensive test coverage for all functionality and edge cases,
        provides type annotations for both TypeScript and Flow users, and is fully
        compatible with both browser and Node.js environments.
    </p>
    <h2>Usage example</h2>
    <pre><code>
    import VirtualClock from &apos;virtual-clock&apos;;
    // or
    const VirtualClock = require(&apos;virtual-clock&apos;).default;

    // Create a new clock
    let clock = new VirtualClock;

    // At instanciation, the clock is stopped at time 0.
    console.log(&apos;Initial clock time: &apos; + clock.time);

    // The `time` property may be queried at any time, for example in a render loop
    let outputElement = document.getElementById(&apos;output&apos;);
    (function loop() {
        outputElement.textContent = (clock.time / 1000).toFixed(5);
        window.requestAnimationFrame(loop);
    })();

    // Start the clock by calling .start()
    clock.start();

    // Or toggling the `running` property
    clock.running = true;

    // Speed up the the flow of time
    clock.rate = 2.0;

    // Or wind back the clock
    clock.rate = -1.0;

    // By default, time is limited between -Infinity and Infinity
    console.log(&apos;Default bounds: &apos; + clock.minimum + &apos; - &apos; + clock.maximum);

    // But for various cases it might be useful to set a finite bound
    clock.minimum = 0;
    clock.maximum = 10 * 1000;

    // When both minimum and maximum are set to non-infinites, we may loop time
    clock.loop = true;

    // Event listeners may be attached to notice changes
    clock.on(&apos;start&apos;, () =&gt; {
        console.log(&apos;The clock has been started!&apos;);
    });
    clock.on(&apos;setrate&apos;, () =&gt; {
        console.log(&apos;The flow rate of time was set!&apos;);
    });

    // Time listeners can be attached to specific clock times
    clock.onceAt(9 * 1000, () =&gt; {
        console.log(&apos;I\&apos;ll fire once at 9, and then never again!&apos;);
    });
    clock.alwaysAt(5 * 1000, () =&gt; {
        console.log(&apos;I\&apos;ll fire every time the clock is at 5!&apos;);
    });

    // We can keep adjusting properties; time listeners will fire as expected
    clock.minimum += 1000;
    clock.rate *= 2;
    </code></pre>
    <h2>API</h2>
    <pre><code>
    class VirtualClock {
        /**
        * Starts running the clock. Does nothing when clock was already running.
        */
        start(): VirtualClock;

        /**
        * Stops running the clock. Does nothing when clock was not running.
        */
        stop(): VirtualClock;

        /**
        * Attaches an event listener.
        *
        * Supported events: start, stop, settime, setrunning, setrate, setminimum, setmaximum, setloop
        */
        on(event: string, callback: () =&gt; mixed): VirtualClock;

        /**
        * Detaches a previously attached event listener.
        */
        off(event: string, callback: () =&gt; mixed): VirtualClock;

        /**
        * Triggers an attached event listener.
        */
        trigger(event: string, ...args: mixed[]): VirtualClock;

        /**
        * Attaches a time listener which fires once after the specified clock time has passed.
        */
        onceAt(time: number, callback: () =&gt; mixed): VirtualClock;

        /**
        * Attaches a time listener which fires every time the specified clock time has passed.
        */
        alwaysAt(time: number, callback: () =&gt; mixed): VirtualClock;

        /**
        * Detaches a previously attached time listener. If multiple listeners match, all are removed.
        */
        removeAt(time: number, callback: () =&gt; mixed): VirtualClock;

        /**
        * The current clock time.
        */
        time: number;

        /**
        * Whether the clock is currently running.
        */
        running: boolean;

        /**
        * The current rate (relative to real time) the clock runs at.
        */
        rate: number;

        /**
        * The minimum limit for time on the clock.
        */
        minimum: number;

        /**
        * The maximum limit for time on the clock.
        */
        maximum: number;

        /**
        * Whether the clock will loop around after reaching the maximum.
        */
        loop: boolean;
    }
    </code></pre>
    <p>
        Note that all methods return the called object to allow for method chaining.
    </p>
    <h2>Issues and contributing</h2>
    <p>
        If you have any issues with <code>virtual-clock</code>, first check the <a href="https://github.com/DvdGiessen/virtual-clock/issues">issue tracker</a> to see whether it was
        already reported by someone else. If not, go ahead and <a href="https://github.com/DvdGiessen/virtual-clock/issues/new">create a new issue</a>. Try to include as much
        information (version of the library, example code to reproduce) as possible.
    </p>
    <p>
        If you want to contribute, feel free to open a pull request on <a href="https://github.com/DvdGiessen/virtual-clock">GitHub</a>!
    </p>
    <h2>License</h2>
    <p>
        <code>virtual-clock</code> is freely distributable under the terms of the
        <a href="https://github.com/DvdGiessen/virtual-clock/blob/master/LICENSE">MIT license</a>.
    </p>
</body>
</html>
